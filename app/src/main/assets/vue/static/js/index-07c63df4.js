import{R as J,S as A,n as C,t as w,u as L,r,D as B,U as q,G as O,A as Q,c as D,d as E,e as m,V as R,z as _,h as W,i as Y,w as K,v as H,j as M,a as z,b as ee,K as te,H as oe,L as ne,J as ae,T as se,F as le,y as ce}from"./index-e392ada0.js";import{o as re,h as ie,c as ue,H as de,I as ve}from"./index-9b715166.js";import{p as N,u as fe}from"./use-expose-217e939b.js";function he(e,{args:t=[],done:o,canceled:s}){if(e){const n=e.apply(null,t);J(n)?n.then(a=>{a?o():s&&s()}).catch(A):n?o():s&&s()}else o()}const ye={show:Boolean,zIndex:C,overlay:w,duration:C,teleport:[String,Object],lockScroll:w,lazyRender:w,beforeClose:Function,overlayStyle:Object,overlayClass:L,transitionAppear:Boolean,closeOnClickOverlay:w};function me(e,t){return e>t?"horizontal":t>e?"vertical":""}function Ie(){const e=r(0),t=r(0),o=r(0),s=r(0),n=r(0),a=r(0),c=r(""),i=()=>c.value==="vertical",u=()=>c.value==="horizontal",I=()=>{o.value=0,s.value=0,n.value=0,a.value=0,c.value=""};return{move:d=>{const v=d.touches[0];o.value=(v.clientX<0?0:v.clientX)-e.value,s.value=v.clientY-t.value,n.value=Math.abs(o.value),a.value=Math.abs(s.value);const f=10;(!c.value||n.value<f&&a.value<f)&&(c.value=me(n.value,a.value))},start:d=>{I(),e.value=d.touches[0].clientX,t.value=d.touches[0].clientY},reset:I,startX:e,startY:t,deltaX:o,deltaY:s,offsetX:n,offsetY:a,direction:c,isVertical:i,isHorizontal:u}}let S=0;const x="van-overflow-hidden";function we(e,t){const o=Ie(),s=u=>{o.move(u);const I=o.deltaY.value>0?"10":"01",P=ie(u.target,e.value),{scrollHeight:h,offsetHeight:d,scrollTop:v}=P;let f="11";v===0?f=d>=h?"00":"01":v+d>=h&&(f="10"),f!=="11"&&o.isVertical()&&!(parseInt(f,2)&parseInt(I,2))&&N(u,!0)},n=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",s,{passive:!1}),S||document.body.classList.add(x),S++},a=()=>{S&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",s),S--,S||document.body.classList.remove(x))},c=()=>t()&&n(),i=()=>t()&&a();re(c),B(i),q(i),O(t,u=>{u?n():a()})}function X(e){const t=r(!1);return O(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const $=Symbol();function Ae(e){const t=Q($,null);t&&O(t,o=>{o&&e()})}const[Pe,Se]=D("overlay"),ke={show:Boolean,zIndex:C,duration:C,className:L,lockScroll:w,lazyRender:w,customStyle:Object};var Ce=E({name:Pe,props:ke,setup(e,{slots:t}){const o=X(()=>e.show||!e.lazyRender),s=a=>{N(a,!0)},n=o(()=>{var a;const c=_(W(e.zIndex),e.customStyle);return Y(e.duration)&&(c.animationDuration=`${e.duration}s`),K(m("div",{style:c,class:[Se(),e.className],onTouchmove:e.lockScroll?s:A},[(a=t.default)==null?void 0:a.call(t)]),[[H,e.show]])});return()=>m(R,{name:"van-fade",appear:!0},{default:n})}});const Oe=M(Ce),be=_({},ye,{round:Boolean,position:z("center"),closeIcon:z("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:z("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[ze,T]=D("popup");let g=2e3;var pe=E({name:ze,inheritAttrs:!1,props:be,emits:["open","close","opened","closed","keydown","update:show","click-overlay","click-close-icon"],setup(e,{emit:t,attrs:o,slots:s}){let n,a;const c=r(),i=r(),u=X(()=>e.show||!e.lazyRender),I=ee(()=>{const l={zIndex:c.value};if(Y(e.duration)){const y=e.position==="center"?"animationDuration":"transitionDuration";l[y]=`${e.duration}s`}return l}),P=()=>{n||(e.zIndex!==void 0&&(g=+e.zIndex),n=!0,c.value=++g,t("open"))},h=()=>{n&&he(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},d=l=>{t("click-overlay",l),e.closeOnClickOverlay&&h()},v=()=>{if(e.overlay)return m(Oe,{show:e.show,class:e.overlayClass,zIndex:c.value,duration:e.duration,customStyle:e.overlayStyle,onClick:d},{default:s["overlay-content"]})},f=l=>{t("click-close-icon",l),h()},j=()=>{if(e.closeable)return m(ve,{role:"button",tabindex:0,name:e.closeIcon,class:[T("close-icon",e.closeIconPosition),de],classPrefix:e.iconPrefix,onClick:f},null)},V=()=>t("opened"),F=()=>t("closed"),G=l=>t("keydown",l),U=u(()=>{var l;const{round:y,position:k,safeAreaInsetTop:b,safeAreaInsetBottom:Z}=e;return K(m("div",ce({ref:i,style:I.value,class:[T({round:y,[k]:k}),{"van-safe-area-top":b,"van-safe-area-bottom":Z}],onKeydown:G},o),[(l=s.default)==null?void 0:l.call(s),j()]),[[H,e.show]])}),p=()=>{const{position:l,transition:y,transitionAppear:k}=e,b=l==="center"?"van-fade":`van-popup-slide-${l}`;return m(R,{name:y||b,appear:k,onAfterEnter:V,onAfterLeave:F},{default:U})};return O(()=>e.show,l=>{l&&!n&&(P(),o.tabindex===0&&te(()=>{var y;(y=i.value)==null||y.focus()})),!l&&n&&(n=!1,t("close"))}),fe({popupRef:i}),we(i,()=>e.show&&e.lockScroll),ue("popstate",()=>{e.closeOnPopstate&&(h(),a=!1)}),oe(()=>{e.show&&P()}),ne(()=>{a&&(t("update:show",!0),a=!1)}),B(()=>{e.show&&e.teleport&&(h(),a=!0)}),ae($,()=>e.show),()=>e.teleport?m(se,{to:e.teleport},{default:()=>[v(),p()]}):m(le,null,[v(),p()])}});const Le=M(pe);export{Le as P,he as c,Ae as o,Ie as u};
